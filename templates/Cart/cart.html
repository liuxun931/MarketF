{% extends "base_layer2.html" %}
{% load static %}

{% block cart %}




<script type="text/javascript">
// 计算购物车里选中商品的总价；
// 将购物车中选中商品的明细（products 和 数量），订单总金额提交到后台。

$(document).ready(function(){
		// set sum price
		//get <input> in table
		sessionStorage.clear();
		var inp = document.getElementById("cart-table").getElementsByTagName("input")
		var l = (inp.length)/2
		function sum_price(){
			var table = document.getElementById("cart-table"); 
			var rows = table.rows;   
			var sum = 0;
			
			for (i = 1; i < l+1; i++){
				//处理单项价格
				var qn = 'qnt-' + (i-1);
				var price = rows[i].cells[1].innerText;
				var qnt = document.getElementById(qn).value;
				rows[i].cells[3].innerText = price*qnt;
				//处理选中项目
				var cks = 'ckb-' + (i-1);
				
				//use sessionStorage to store data
				
				
				if(document.getElementById(cks).checked == true){
					sum += price*qnt;
					//sessionStorage.setItem(qn, (price*qnt));
					//sessionStorage.setItem("pd"+price, price);
					//也可以将商品名称明细存入session
					sessionStorage.setItem("sum", sum);
					//console.log(sessionStorage.getItem(qn));
					//console.log(sessionStorage.getItem("pd"+price));
					console.log(sessionStorage.getItem("sum"));
				}
				
			}
			//选中项目写入总价
			document.getElementById("sum-order").value = sum;
		}
		sum_price();

		//control input [quantity]
		//auto price 
		
		$("#cart-table").bind('input propertychange', function(){
			for (i = 0; i<l; i++){
				if( inp[i].value > 200 || inp[i].value < 1){
					inp[i].value = 1;
				}
				var cks = 'ckb-' + i;
				if (document.getElementById(cks).checked == false){
				sessionStorage.setItem("sum", 0);
				console.log("sessionstorage .sum = 0");
				}
			}
			sum_price();
		})
		
		//写入session
		
		$("btn-sum").click(function(){
			console.log("button");
		})
		
	})

</script>


<div class = "container">

<div class="row">
<div class="col-4 offset-4 center"> 
<a style="color:green;font-size:large;padding-bottom:20px;padding-top:30px;">我的购物车</a>
</div>
</div>

<div class="row">

<div class="col-10 offset-1"> 

<form method="post" action="/Pay/" > {% csrf_token %} 

<div class="form-group">

<!-- items here -->

<table id="cart-table" class="table table-striped table-hover" >

	<thead>
		<tr>

			<th scope="col">商品名称</th>
			<th scope="col">金额：元</th>
			<th scope="col">数量</th>
			<th scope="col">小计</th>
			<th scope="col">购买</th>

		</tr>
	</thead>
	
	<tbody>
	{% for t in items %}
		<tr>
			<th scope="row">{{t.0}}</th>
			<td> {{ t.1 }}</td>
			<td>
				<label for="qnt-input" >数量: </label>
				<input type="number" id="qnt-{{t.3}}" name="ipt-{{t.3}}" style="width:50px;" value="{{t.2}}" > </input>
			</td>
			<td>
				<!-- 小计 -->
			</td>		
			<td>
				<!-- 购买 -->
				<input type="checkbox" name="ckipt-{{t.3}}"  id="ckb-{{t.3}}" style="width:20px;" > </input>
			</td>
		</tr>
	{% endfor %}
	  </tbody>

</table>   


<!--end items here -->

<!-- set sum -->



<div class="row">
	
	<div class="cal-2 offset-6">

		<button id="btn-sum" class="btn btn-outline-danger" type="submit" value="Save" >提交订单：</button>

	</div>
	
	<div class="cal-2 offset-8">

		<input id="sum-order" name="sum-cart" type="value" class="form-control" style="width:80px;" disabled> </input>

	</div>

</div><!-- end set sum -->

<script type="text/javascript">


</script>

</div>
</form>

</div>
</div>
</div>




  








{% endblock %}
